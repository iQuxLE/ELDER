
# ELDER
Elder is an algorithm that uses text-embeddings for differential diagnosis tasks. It will take any list of `phenotype_term`(`hpo_id`) as input and queries a chromaDB collection 
consisting of Disease and the average of embeddings of all referring phenotype terms.

Those embeddings are generated by curate-gpt(https://github.com/iQuxLE/curate-gpt). To use it a user needs to download the `ont-hp` collection.
Furthermore you can use the `phenotype.hpoa` file to generate the DiseaseAverageCollection that contains an embedding for each disease or the `hpoa` collection created by curate-gpt.

By using [pheval](https://github.com/monarch-initiative/pheval) you can compare those results to [Exomiser](https://github.com/exomiser/Exomiser). Therefore, I created another [repository](https://github.com/iQuxLE/eval-elder) that already incorporates this comparison.
To do the comparison to the full LIRICAL dataset you will need to take the data from the [pheval-repo](https://github.com/monarch-initiative/pheval) from `/corpora/phenopackets`. Than use `phevals` PhenopacketUtils to iterate over those.

## Methods
We implemented different approaches. 
1. Averaging each Disease into an Embedding. This works by now the best.
     
2. Clustering each Disease into their relevant organ systems and average all HP terms in one organ system, to get a relevant representation of each organ_system inside a disease        represented by the set of HP terms that cover this organ system. If HP terms do not cover all organ systems this vector will be multiplied by the embedding of the organ system * -1 for the whole length of the vector.
   - **TODO**: it makes sense to play around with values from 0.1 to 0.5 for the start as a representation of -1 * organ_embedding has too much of a negativ effect on the overall representation, thus affects the output immensly, as most disease do not cover more than 3 organ systems.

However, this approach is computationally, for chromaDB, very overwhelming, so querying all 385 observed rare disease patients from the LIRICAL dataset takes about 30h, as each disease-vector will have a dimension of >35k. 

3. Weighting the embeddings by the frequency of each phenotype thats observed inside the `phenotype.hpoa` file



### Run
`python -m main.main`

### .env: file

`PROJECT_ROOT="path/to/repo"`

and in config.yaml
add your path to chromaDB with ont_hp and hpoa collection
